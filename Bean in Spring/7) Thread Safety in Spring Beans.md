# 스프링 빈(bean)은 thread-safe할까?
## 스프링 빈(bean)은 thread-safe하지 않다.
- thread-safe 하지 못한 빈(bean) 클래스는 어떤 경우일까?
- 값이 변할 수 있는 인스턴스 멤버 변수가 존재한다면 thread-safe하지 않다.
  - (무상태(stateless)인 빈(bean) 클래스를 만들어야 한다. 그리고 이 사실은 빈 뿐만 아니라 모든 객체에 해당된다.)

```java
class MyBean{
    String name; // 멀티 쓰레드 환경에서 문제 발생의 원인!

    public void setName(String name) {  
        this.name = name; // 이름이 바뀐다면 다른 쓰레드에도 영향을 받게 된다.
        ...
    }
}
```

- 위와 같이 name이라는 인스턴스 변수가 존재하는데 setName() 메소드를 이용하면 변수 값이 바뀌게 된다.
- 하지만 바뀐 값이 다른 쓰레드 입장에서는 예상치 못한 변화로 문제를 일으킬 수 있다.

## 해결 방법
### 1) 각 요청에 맞는 변수 값이 필요하다면, 인스턴스 멤버 변수로 선언하지 말고 지역 변수로써 사용한다.
```java
class MyBean {
    public void setName(String name){ 
        name ... // 지역 변수로써 사용하게 되면 영향이 없다.
    }
}
```
- 혹은 읽기 전용으로 사용해야 한다.

### 2) (지역 변수를 사용하고 싶지 않다면) scope 옵션을 prototype으로 한다.
- 기본적인 scope 설정은 singleton이기 때문에, 새로운 요청이 들어와도 하나의 빈(bean)객체가 처리를 하게 된다.
- 이러한 경우 scope 설정을 prototype으로 둔다면 매 요청마다 새로운 객체가 생성되어 처리된다.
  - 하지만 매 요청마다 객체가 새로 생성된다는 것은 성능 상의 많은 단점을 내포하고 있으니 상황에 잘 맞게 사용해야 한다.

## 요약
- 스프링 빈(bean)은 thread-safe 하지 않다.
- 스프링 빈(bean) 클래스에 인스턴스 변수 멤버가 있지 않은지 확인해보자. 만약 존재한다면 읽기 전용인 경우만 허용한다.
  - 값이 변하는 변수인 경우 지역 변수로 사용한다.
